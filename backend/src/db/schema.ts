// ERP Financial Database Schema - DotNetApprova 4.5 Compatible
import Database from 'better-sqlite3';
import path from 'path';

const DB_PATH = process.env.DATABASE_PATH || path.resolve(process.cwd(), 'local_database.db');

// ูุตู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุงููุฉ ุงูุญููููุฉ - ูุธุงู DotNetApprova 4.5
export const getERPSchemaDescription = () => {
  return `
# ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุงููุฉ ูุงููุฎุฒููุฉ - ูุธุงู DotNetApprova 4.5
# ุดุฑูุฉ ุฅุจุฏุงุน ุณููุช - ุงููุธุงู ุงููุชูุงูู ูููุญุงุณุจุฉ ูุงููุฎุฒูู

## ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ (Views ุงููุนุชูุฏุฉ):

### 1. ุฌุฏูู ุฏููู ุงูุญุณุงุจุงุช (vewAccountsList)
-- ุงูุบุฑุถ: ุฅุฏุงุฑุฉ ุงูุดุฌุฑุฉ ุงููุญุงุณุจูุฉ ูุชุตููู ุงูุญุณุงุจุงุช
ุงูุฃุนูุฏุฉ:
- id: ุงููุนุฑู ุงููุฑูุฏ ููุญุณุงุจ
- account_name: ุงุณู ุงูุญุณุงุจ (ูุซู: ุงูููุฏูุฉุ ุงูุจููุ ุงูุนููุงุกุ ุงูููุฑุฏููุ ุงููุจูุนุงุชุ ุงููุดุชุฑูุงุช)
- father_number: ุฑูู ุงูุญุณุงุจ ุงูุฃุจ ูู ุงูุดุฌุฑุฉ ุงููุญุงุณุจูุฉ
- account_number: ุฑูู ุงูุญุณุงุจ ุงููุฑุนู
- account_type: ููุน ุงูุญุณุงุจ (ุฃุตููุ ุฎุตููุ ุฅูุฑุงุฏุงุชุ ูุตุฑููุงุชุ ุญููู ููููุฉ)
- branch_id: ูุนุฑู ุงููุฑุน ุงูุชุงุจุน ูู ุงูุญุณุงุจ
- the_type_id: ูุนุฑู ุชุตููู ููุน ุงูุญุณุงุจ

### 2. ุฌุฏูู ุงูุนููุงุก ูุงูููุฑุฏูู (vewInv_CustomersSuppliers)
-- ุงูุบุฑุถ: ุฅุฏุงุฑุฉ ุจูุงูุงุช ุงูุนููุงุก ูุงูููุฑุฏูู ูุน ุงููุนูููุงุช ุงูุชุฌุงุฑูุฉ ูุงููุงููุฉ
ุงูุฃุนูุฏุฉ ุงูุฑุฆูุณูุฉ:
- id: ุงููุนุฑู ุงููุฑูุฏ
- number: ุฑูู ุงูุนููู/ุงูููุฑุฏ
- code: ููุฏ ูุฎุชุตุฑ
- type: ููุน ุงูุทุฑู (ุนููู/ููุฑุฏ/ููุงููุง)
- client_name: ุงุณู ุงูุนููู/ุงูููุฑุฏ
- account_name: ุงุณู ุงูุญุณุงุจ ุงููุญุงุณุจู ุงููุฑุชุจุท
- is_active: ุญุงูุฉ ุงููุดุงุท (1=ูุดุทุ 0=ุบูุฑ ูุดุท)
- credit_period: ูุชุฑุฉ ุงูุงุฆุชูุงู ุงููุณููุญุฉ (ุจุงูุฃูุงู)
- discount_rate: ูุนุฏู ุงูุฎุตู ุงููุณููุญ (%)
- due_days: ุฃูุงู ุงูุงุณุชุญูุงู ููุฏูุน
- annual_contract_amount: ูููุฉ ุงูุนูุฏ ุงูุณูููุฉ
- commission_rate: ูุนุฏู ุงูุนูููุฉ (%)
- region: ุงูููุทูุฉ/ุงููุญุงูุธุฉ
- branch_id: ูุนุฑู ุงููุฑุน
- entry_time: ููุช ุงูุฅุฏุฎุงู

### 3. ุฌุฏูู ุญุฑูุงุช ุงููุฎุฒูู ูุงููุจูุนุงุช (vewInv_ItemsMain)
-- ุงูุบุฑุถ: ุชุณุฌูู ุฌููุน ุญุฑูุงุช ุงููุฎุฒูู (ูุจูุนุงุชุ ูุดุชุฑูุงุชุ ุชุญูููุงุช) ูุน ุชูุงุตูู ุงูุฃุตูุงู
ุงูุฃุนูุฏุฉ ุงููููุฉ:
- id: ุงููุนุฑู ุงููุฑูุฏ ููุญุฑูุฉ
- parent_id: ูุนุฑู ุงููุซููุฉ ุงูุฃุณุงุณูุฉ
- the_date: ุชุงุฑูุฎ ุงูุญุฑูุฉ
- document_name: ููุน ุงููุซููุฉ (ูุงุชูุฑุฉ ูุจูุนุงุชุ ูุงุชูุฑุฉ ูุดุชุฑูุงุชุ ุฅุฑุฌุงุนุ ุชุญููู ูุฎุฒูู)
- the_number: ุฑูู ุงููุซููุฉ
- client_id: ูุนุฑู ุงูุนููู/ุงูููุฑุฏ
- client_name: ุงุณู ุงูุนููู/ุงูููุฑุฏ
- item_id: ูุนุฑู ุงูุตูู
- item_name: ุงุณู ุงูุตูู
- item_type: ููุน ุงูุตูู (ุณูุนุฉ/ุฎุฏูุฉ)
- category_name: ูุฆุฉ ุงูุตูู
- unit_name: ูุญุฏุฉ ุงูููุงุณ
- unit_price: ุณุนุฑ ุงููุญุฏุฉ
- quantity: ุงููููุฉ
- amount: ุฅุฌูุงูู ุงููุจูุบ (quantity ร unit_price - item_discount)
- item_discount: ุฎุตู ุงูุตูู
- currency_name: ุงูุนููุฉ ุงููุณุชุฎุฏูุฉ
- store_name: ุงุณู ุงููุฎุฒู
- branch_name: ุงุณู ุงููุฑุน
- user_name: ุงููุณุชุฎุฏู ุงููุฏุฎู
- expiry_date: ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ (ููุฃุตูุงู ุงููุงุจูุฉ ููุงูุชูุงุก)

### 4. ุฌุฏูู ุงููููุฏ ุงููุญุงุณุจูุฉ (vewJournalEntries)
-- ุงูุบุฑุถ: ุชุณุฌูู ุฌููุน ุงููููุฏ ุงููุญุงุณุจูุฉ ุงููุนุชูุฏุฉ ูู ุงููุธุงู
ุงูุฃุนูุฏุฉ:
- id: ุงููุนุฑู ุงููุฑูุฏ ููููุฏ
- parent_id: ูุนุฑู ุงูููุฏ ุงูุฃุณุงุณู (ูููููุฏ ุงููุฑูุจุฉ)
- amount: ูุจูุบ ุงูููุฏ
- currency: ุงูุนููุฉ ุงููุณุชุฎุฏูุฉ
- debit: ุงููุจูุบ ุงููุฏูู
- credit: ุงููุจูุบ ุงูุฏุงุฆู
- entry: ูุตู ุงูููุฏ ุงููุญุงุณุจู
- account: ุงุณู ุงูุญุณุงุจ ุงููุญุงุณุจู
- notes: ููุงุญุธุงุช ุฅุถุงููุฉ
- cost_center: ูุฑูุฒ ุงูุชูููุฉ
- reference_number: ุงูุฑูู ุงููุฑุฌุนู ููููุฏ
- journal_number: ุฑูู ุฏูุชุฑ ุงูููููุฉ
- user: ุงุณู ุงููุณุชุฎุฏู ุงููุฏุฎู
- branch: ุงุณู ุงููุฑุน
- entry_time: ููุช ุฅุฏุฎุงู ุงูููุฏ

## ุงูุนูุงูุงุช ูุงูุฑูุงุจุท:
1. vewInv_CustomersSuppliers.id = vewInv_ItemsMain.client_id (ุงูุนููุงุก ูุงูุญุฑูุงุช)
2. vewAccountsList ูุฑุชุจุท ูุน ุฌููุน ุงูุฌุฏุงูู ุนุจุฑ ุฃุณูุงุก ุงูุญุณุงุจุงุช
3. ูู ุญุฑูุฉ ูู vewInv_ItemsMain ุชููุฏ ูููุฏ ูุญุงุณุจูุฉ ูู vewJournalEntries

## ููุงุนุฏ ุงูุงุณุชุนูุงู ุงููููุฉ:
- ูููุจูุนุงุช: document_name LIKE '%ูุจูุนุงุช%' ุฃู '%ูุงุชูุฑุฉ ูุจูุนุงุช%'
- ูููุดุชุฑูุงุช: document_name LIKE '%ูุดุชุฑูุงุช%' ุฃู '%ูุงุชูุฑุฉ ูุดุชุฑูุงุช%'
- ููุนููุงุก ุงููุดุทูู: is_active = 1
- ููุญุณุงุจุงุช ุงููุฑุนูุฉ: father_number IS NOT NULL
- ููุฃุฑุตุฏุฉ: SUM(debit - credit) ูู ุฌุฏูู ุงููููุฏ

## ุฃูุซูุฉ ุงุณุชุนูุงูุงุช ุดุงุฆุนุฉ:
- ุฅุฌูุงูู ุงููุจูุนุงุช: SELECT SUM(amount) FROM vewInv_ItemsMain WHERE document_name LIKE '%ูุจูุนุงุช%'
- ุฃูุถู ุงูุนููุงุก: SELECT client_name, SUM(amount) FROM vewInv_ItemsMain GROUP BY client_id ORDER BY SUM(amount) DESC
- ุฑุตูุฏ ุญุณุงุจ: SELECT SUM(debit - credit) FROM vewJournalEntries WHERE account = 'ุงุณู ุงูุญุณุงุจ'
`;
};

// ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ููุญุตูู ุนูู ูุตู ูุงุนุฏุฉ ุงูุจูุงูุงุช
export function getSchemaDescription() {
  return getERPSchemaDescription();
}

// ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช (ููุชูุงูู ูุน ุงูููุฏ ุงูููุฌูุฏ)
export function initializeDatabase() {
  console.log('๐ Using existing ERP database: local_database.db');
  console.log('โ ERP Financial Database is ready');
  return { success: true, message: 'ERP Database connected successfully' };
}

export { DB_PATH };